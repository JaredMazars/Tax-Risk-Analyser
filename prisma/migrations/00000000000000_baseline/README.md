# Baseline Migration - Full Database Introspection

**Date:** 2026-01-25  
**Type:** Complete Database Baseline  
**Source:** Direct SQL Server introspection (not Prisma schema)

## Overview

This baseline migration was generated by introspecting the actual SQL Server database, ensuring complete capture of all database objects including those not representable in Prisma schema.

## Contents

### Part 1: Tables (98 tables)
- All table definitions with columns, data types, and constraints
- Identity columns properly marked
- Default constraints included inline

### Part 2: Indexes (490 indexes)
- All nonclustered indexes
- **Super covering indexes with INCLUDE columns:**
  - `idx_wip_gsclientid_super_covering` (WIPTransactions)
  - `idx_wip_gstaskid_super_covering` (WIPTransactions)
  - `idx_drs_gsclientid_super_covering` (DrsTransactions)
  - `idx_drs_biller_super_covering` (DrsTransactions)
- Filtered indexes with WHERE clauses
- Primary key constraints

### Part 3: Foreign Keys (131 constraints)
- All foreign key relationships
- ON DELETE and ON UPDATE actions preserved

### Part 4: Stored Procedures (3 procedures)
- `sp_GetProfitabilityByTasks`
- `WipLTD`
- `WipLTD_V2`

## Key Features Captured

### Super Covering Indexes
Unlike Prisma-generated migrations, this baseline properly captures indexes with INCLUDE columns:

```sql
CREATE NONCLUSTERED INDEX [idx_wip_gsclientid_super_covering]
ON [dbo].[WIPTransactions]([GSClientID], [TranDate])
INCLUDE ([TType], [TranType], [Amount], [Cost], [Hour], [MainServLineCode], [TaskPartner], [TaskManager], [updatedAt])
WHERE [GSClientID] IS NOT NULL;
```

### Filtered Indexes
Indexes with WHERE clauses are preserved:

```sql
WHERE [GSClientID] IS NOT NULL
WHERE [GSTaskID] IS NOT NULL
```

## How This Was Generated

1. Queried `INFORMATION_SCHEMA.TABLES` and `INFORMATION_SCHEMA.COLUMNS` for table structure
2. Queried `sys.indexes` and `sys.index_columns` for all indexes including INCLUDE columns
3. Queried `sys.foreign_keys` and `sys.foreign_key_columns` for relationships
4. Queried `sys.default_constraints` for default values
5. Queried `sys.procedures` for stored procedure definitions

## For New Deployments

This migration is marked as "applied" - it will not run on the existing database.

For new deployments:
```bash
npx prisma migrate deploy
```

## Previous Migrations

All previous migrations (87+) were backed up to:
- `prisma/migrations_backup_20260125/`

## Statistics

| Object Type | Count |
|-------------|-------|
| Tables | 98 |
| Columns | 1329 |
| Indexes | 490 |
| Foreign Keys | 131 |
| Default Constraints | 194 |
| Stored Procedures | 3 |
